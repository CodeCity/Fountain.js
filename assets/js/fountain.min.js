(function(){var e={title_page:/^((?:Title|Credit|Author[s]?|Source|Notes|Draft date|Date|Contact|Copyright)\:)/gm,scene_heading:/^((?:(?:int|ext|est|i\/e)[. ]).+)|^(?:\.)(.+)/i,scene_number:/( *#(.+)# *)/,transition:/^((?:FADE (?:TO BLACK|OUT)|CUT TO BLACK)\.|.+ TO\:)|^(?:> *)(.+)/,dialogue:/^([A-Z]+[0-9A-Z (._\-')]*)(\^?)?(?:\n(?!\n+))([\s\S]+)/,parenthetical:/^(\(.+\))$/,action:/^(.+)/g,centered:/^(?:> *)(.+)(?: *<)(\n.+)*/g,section:/^(#+)(?: *)(.*)/,synopsis:/^(?:\=(?!\=+) *)(.*)/,note:/^(?:\[{2}(?!\[+))(.+)(?:\]{2}(?!\[+))$/,
boneyard:/(^\/\*|^\*\/)$/gm,page_break:/^\={3,}$/,line_break:/^ {2}$/,bold_italic_underline:/(_{1}\*{3}(?=.+\*{3}_{1})|\*{3}_{1}(?=.+_{1}\*{3}))(.+?)(\*{3}_{1}|_{1}\*{3})/g,bold_underline:/(_{1}\*{2}(?=.+\*{2}_{1})|\*{2}_{1}(?=.+_{1}\*{2}))(.+?)(\*{2}_{1}|_{1}\*{2})/g,italic_underline:/(?:_{1}\*{1}(?=.+\*{1}_{1})|\*{1}_{1}(?=.+_{1}\*{1}))(.+?)(\*{1}_{1}|_{1}\*{1})/g,bold_italic:/(\*{3}(?=.+\*{3}))(.+?)(\*{3})/g,bold:/(\*{2}(?=.+\*{2}))(.+?)(\*{2})/g,italic:/(\*{1}(?=.+\*{1}))(.+?)(\*{1})/g,underline:/(_{1}(?=.+_{1}))(.+?)(_{1})/g,
splitter:/\n{2,}/g,cleaner:/^\n+|\n+$/,standardizer:/\r\n|\r/g,whitespacer:/^\t+|^ {3,}/gm},m={line_break:"<br />",bold_italic_underline:'<span class="bold italic underline">$2</span>',bold_underline:'<span class="bold underline">$2</span>',italic_underline:'<span class="italic underline">$2</span>',bold_italic:'<span class="bold italic">$2</span>',bold:'<span class="bold">$2</span>',italic:'<span class="italic">$2</span>',underline:'<span class="underline">$2</span>',lexer:function(d){if(d){for(var i=
"underline,italic,bold,bold_italic,italic_underline,bold_underline,bold_italic_underline".split(","),j=i.length,f,c;j--;)f=i[j],c=e[f],c.test(d)&&(d=d.replace(c,m[f]));return d.replace(/\n/g,m.line_break).trim()}}},g=function(d,e){return g.parse(d,e)};g.parse=function(d,i,j){void 0===j&&"function"===typeof i&&(j=i,i=void 0);for(var f=d.replace(e.boneyard,"\n$1\n").replace(e.standardizer,"\n").replace(e.cleaner,"").replace(e.whitespacer,"").split(e.splitter),c=f.length,a,b,k,h,g,d=[];c--;)if(a=f[c],
e.title_page.test(a)){b=a.replace(e.title_page,"\n$1").split(e.splitter).reverse();h=0;for(g=b.length;h<g;h++)k=b[h].replace(e.cleaner,"").split(/\:\n*/),d.push({type:k[0].trim().toLowerCase().replace(" ","_"),text:k[1].trim()})}else if(b=a.match(e.scene_heading)){if(a=b[1]||b[2],a.indexOf("  ")!==a.length-2){if(b=a.match(e.scene_number))b=b[2],a=a.replace(e.scene_number,"");d.push({type:"scene_heading",text:a,scene_number:b||void 0})}}else if(b=a.match(e.centered))d.push({type:"centered",text:b[0].replace(/>|</g,
"")});else if(b=a.match(e.transition))d.push({type:"transition",text:b[1]||b[2]});else if((b=a.match(e.dialogue))&&b[1].indexOf("  ")!==b[1].length-2){d.push({type:"dialogue_end"});k=b[3].split("\n").reverse();h=0;for(g=k.length;h<g;h++)a=k[h],e.line_break.test(a)?d.push({type:"line_break"}):d.push({type:e.parenthetical.test(a)?"parenthetical":"dialogue",text:a});d.push({type:"character",text:b[1].trim()});d.push({type:"dialogue_begin",dual:b[2]?!0:void 0})}else(b=a.match(e.section))?d.push({type:"section",
text:b[2],depth:b[1].length}):(b=a.match(e.synopsis))?d.push({type:"synopsis",text:b[1]}):(b=a.match(e.note))?d.push({type:"note",text:b[1]}):(b=a.match(e.boneyard))?d.push({type:"/"===b[0][0]?"boneyard_begin":"boneyard_end"}):e.page_break.test(a)?d.push({type:"page_break"}):e.line_break.test(a)?d.push({type:"line_break"}):d.push({type:"action",text:a});var f=d.length,l;b=[];for(a=[];f--;)switch(c=d[f],c.text=m.lexer(c.text),c.type){case "title":b.push("<h1>"+c.text+"</h1>");l=c.text.replace("<br />",
" ").replace(/<(?:.|\n)*?>/g,"");break;case "credit":b.push('<p class="credit">'+c.text+"</p>");break;case "author":b.push('<p class="authors">'+c.text+"</p>");break;case "authors":b.push('<p class="authors">'+c.text+"</p>");break;case "source":b.push('<p class="source">'+c.text+"</p>");break;case "notes":b.push('<p class="notes">'+c.text+"</p>");break;case "draft_date":b.push('<p class="draft-date">'+c.text+"</p>");break;case "date":b.push('<p class="date">'+c.text+"</p>");break;case "contact":b.push('<p class="contact">'+
c.text+"</p>");break;case "copyright":b.push('<p class="copyright">'+c.text+"</p>");break;case "scene_heading":a.push("<h3>"+c.text+"</h3>");break;case "transition":a.push("<h2>"+c.text+"</h2>");break;case "dialogue_begin":a.push('<div class="dialogue'+(c.dual?" dual-dialogue right":"")+'">');break;case "character":a.push("<h4>"+c.text+"</h4>");break;case "parenthetical":a.push('<p class="parenthetical">'+c.text+"</p>");break;case "dialogue":a.push("<p>"+c.text+"</p>");break;case "dialogue_end":a.push("</div> ");
break;case "section":a.push('<p class="section" data-depth="'+c.depth+'">'+c.text+"</p>");break;case "synopsis":a.push('<p class="synopsis">'+c.text+"</p>");break;case "note":a.push("<\!-- "+c.text+"--\>");break;case "boneyard_begin":a.push("<\!-- ");break;case "boneyard_end":a.push(" --\>");break;case "action":a.push("<p>"+c.text+"</p>");break;case "centered":a.push('<p class="centered">'+c.text+"</p>");break;case "page_break":a.push("<hr />");break;case "line_break":a.push("<br />")}l={title:l,
html:{title_page:b.join(""),script:a.join("")},tokens:i?d.reverse():void 0};return"function"===typeof j?j(l):l};"undefined"!==typeof module?module.exports=g:this.fountain=g}).call(this);